@page
@model Cinemo.Pages.BookTicketModel
@{
  var NumRow = 10;

  var NumCol = 10;
}

@section Styles {
  <style>
    .quantity-input {
      max-width: 100px;
    }

    .table-tickets td {
      vertical-align: middle;
    }

    .table-tickets th {
      vertical-align: middle;
    }

    .screen {
      border-bottom: 2px solid black;
    }

    .seat {
      display: inline-block;
      width: 20px;
      height: 20px;
      text-align: center;
      vertical-align: middle;
    }
  </style>
}

@section Scripts {
  <script>
    $(function () {
      $('.quantity-input').on('input', function (e) {
        const string = $(this).val().replace(/\D/g, "");

        const value = parseInt(string, 10) || 0;

        $(this).val(value || 0);
      });

      $('.quantity-input').keyup(function (e) {
        if ([13, 27].includes(e.which)) {
          $(this).blur();
        }
      })

      $('.quantity-input').blur(function (e) {
        const tr = $(this).closest('tr');

        const price = parseInt(
          tr.find('.ticket-price')
            .text()
            .replace(/\,/g, ''),
          10);

        tr.find('.total-tickets-price').html(
          (price * $(this).val()).toLocaleString('en-US')
        );
      })

      $('.btn-minus, .btn-plus').click(function (e) {
        const input = $(this).siblings('.quantity-input')

        const newQuantity = $(this).hasClass('btn-minus') ? Math.max(0, input.val() - 1) : +input.val() + 1;

        input.val(newQuantity);

        $(this).closest('tr').find('.quantity-input').blur();
      });

    })
  </script>
}

<div class="row">
  <div class="col-md-9 col-12">
    <div class="card mb-5">
      <h5 class="card-header">
        Choose tickets
      </h5>

      <div class="card-body">
        <table class="table table-striped table-tickets m-0">
          <thead class="thead-dark">
            <tr>
              <th scope="col">Ticket Type</th>
              <th scope="col" class="text-center">Quantity</th>
              <th scope="col" class="text-right">Price (VND)</th>
              <th scope="col" class="text-right">Total (VND)</th>
            </tr>
          </thead>

          <tbody>
            <tr>
              <td>Normal</td>
              <td>
                <div class="d-flex align-items-center justify-content-center">
                  <button class="btn btn-round btn-primary btn-xs btn-minus"><i class="fas fa-minus fa-fw"></i></button>

                  <input class="form-control form-control-sm quantity-input text-center mx-2" value="0" />

                  <button class="btn btn-round btn-primary btn-xs btn-plus"><i class="fas fa-plus fa-fw"></i></button>
                </div>
              </td>
              <td class="text-right ticket-price">75,000</td>
              <td class="text-right total-tickets-price">0</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <div class="card">
      <h5 class="card-header">
        Choose seats
      </h5>

      <div class="card-body">
        <div class="room d-flex flex-column align-items-center">
          <div class="screen pb-1 text-center w-50">
            Screen
          </div>

          <div>
            @for (var row = 1; row <= NumRow; row++) {
              var rowChar = (char)(row + 64);

              <div class="seat mr-3">
                @rowChar
              </div>

              @for (var col = 1; col <= NumCol; col++) {
                <div class="seat" title="@rowChar@col">
                  @col
                </div>
              }

              <div class="seat ml-3">
                @rowChar
              </div>

              <br />
            }
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="col-3">

  </div>
</div>